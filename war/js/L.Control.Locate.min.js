/*! Version: 0.31.0
Date: 2014-10-28 */
/*!
Copyright (c) 2014 Dominik Moritz

This file is part of the leaflet locate control. It is licensed under the MIT license.
You can find the project at: https://github.com/domoritz/leaflet-locatecontrol
*/
!function(a,b){"function"==typeof define&&define.amd?define(["leaflet"],a):"object"==typeof exports&&(module.exports=a(require("leaflet"))),"undefined"!=typeof b&&b.L&&(b.L.Locate=a(L))}(function(a){return a.Control.Locate=a.Control.extend({options:{position:"topleft",drawCircle:!0,follow:!1,stopFollowingOnDrag:!1,remainActive:!1,markerClass:a.circleMarker,circleStyle:{color:"#136AEC",fillColor:"#136AEC",fillOpacity:.15,weight:2,opacity:.5},markerStyle:{color:"#136AEC",fillColor:"#2A93EE",fillOpacity:.7,weight:2,opacity:.9,radius:5},followCircleStyle:{},followMarkerStyle:{},icon:"fa fa-map-marker",iconLoading:"fa fa-spinner fa-spin",circlePadding:[0,0],metric:!0,onLocationError:function(a){alert(a.message)},onLocationOutsideMapBounds:function(a){a.stopLocate(),alert(a.options.strings.outsideMapBoundsMsg)},setView:!0,keepCurrentZoomLevel:!1,showPopup:!0,strings:{title:"Show me where I am",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:1/0,watch:!0}},initialize:function(b){a.Map.addInitHook(function(){this.options.locateControl&&(this.locateControl=a.control.locate(),this.addControl(this.locateControl))});for(var c in b)"object"==typeof this.options[c]?a.extend(this.options[c],b[c]):this.options[c]=b[c]},onAdd:function(b){var c=a.DomUtil.create("div","leaflet-control-locate leaflet-bar leaflet-control"),d=this;this._layer=new a.LayerGroup,this._layer.addTo(b),this._event=void 0,this._locateOptions=this.options.locateOptions,a.extend(this._locateOptions,this.options.locateOptions),a.extend(this._locateOptions,{setView:!1});var e={};a.extend(e,this.options.markerStyle,this.options.followMarkerStyle),this.options.followMarkerStyle=e,e={},a.extend(e,this.options.circleStyle,this.options.followCircleStyle),this.options.followCircleStyle=e,this._link=a.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single",c),this._link.href="#",this._link.title=this.options.strings.title,this._icon=a.DomUtil.create("span",this.options.icon,this._link),a.DomEvent.on(this._link,"click",a.DomEvent.stopPropagation).on(this._link,"click",a.DomEvent.preventDefault).on(this._link,"click",function(){var a=void 0===d._event||b.getBounds().contains(d._event.latlng)||!d.options.setView||j();!d.options.remainActive&&d._active&&a?o():f()}).on(this._link,"dblclick",a.DomEvent.stopPropagation);var f=function(){d.options.setView&&(d._locateOnNextLocationFound=!0),d._active||b.locate(d._locateOptions),d._active=!0,d.options.follow&&h(),d._event?k():m("requesting")},g=function(a){d._event&&d._event.latlng.lat===a.latlng.lat&&d._event.latlng.lng===a.latlng.lng&&d._event.accuracy===a.accuracy||d._active&&(d._event=a,d.options.follow&&d._following&&(d._locateOnNextLocationFound=!0),k())},h=function(){b.fire("startfollowing",d),d._following=!0,d.options.stopFollowingOnDrag&&b.on("dragstart",i)},i=function(){b.fire("stopfollowing",d),d._following=!1,d.options.stopFollowingOnDrag&&b.off("dragstart",i),l()},j=function(){return void 0===d._event?!1:b.options.maxBounds&&!b.options.maxBounds.contains(d._event.latlng)},k=function(){void 0===d._event.accuracy&&(d._event.accuracy=0);var c=d._event.accuracy;d._locateOnNextLocationFound&&(j()?d.options.onLocationOutsideMapBounds(d):b.fitBounds(d._event.bounds,{padding:d.options.circlePadding,maxZoom:d.options.keepCurrentZoomLevel?b.getZoom():d._locateOptions.maxZoom}),d._locateOnNextLocationFound=!1);var e,f;if(d.options.drawCircle)if(e=d._following?d.options.followCircleStyle:d.options.circleStyle,d._circle){d._circle.setLatLng(d._event.latlng).setRadius(c);for(f in e)d._circle.options[f]=e[f]}else d._circle=a.circle(d._event.latlng,c,e).addTo(d._layer);var g,h;d.options.metric?(g=c.toFixed(0),h="meters"):(g=(3.2808399*c).toFixed(0),h="feet");var i;if(i=d._following?d.options.followMarkerStyle:d.options.markerStyle,d._marker){d._marker.setLatLng(d._event.latlng);for(f in i)d._marker.options[f]=i[f]}else d._marker=d.options.markerClass(d._event.latlng,i).addTo(d._layer);var k=d.options.strings.popup;d.options.showPopup&&k&&d._marker.bindPopup(a.Util.template(k,{distance:g,unit:h}))._popup.setLatLng(d._event.latlng),l()},l=function(){d._container&&m(d._following?"following":"active")},m=function(b){"requesting"==b?(a.DomUtil.removeClasses(d._container,"active following"),a.DomUtil.addClasses(d._container,"requesting"),a.DomUtil.removeClasses(d._icon,d.options.icon),a.DomUtil.addClasses(d._icon,d.options.iconLoading)):"active"==b?(a.DomUtil.removeClasses(d._container,"requesting following"),a.DomUtil.addClasses(d._container,"active"),a.DomUtil.removeClasses(d._icon,d.options.iconLoading),a.DomUtil.addClasses(d._icon,d.options.icon)):"following"==b&&(a.DomUtil.removeClasses(d._container,"requesting"),a.DomUtil.addClasses(d._container,"active following"),a.DomUtil.removeClasses(d._icon,d.options.iconLoading),a.DomUtil.addClasses(d._icon,d.options.icon))},n=function(){d._active=!1,d._locateOnNextLocationFound=d.options.setView,d._following=!1};n();var o=function(){b.stopLocate(),b.off("dragstart",i),d.options.follow&&d._following&&i(),a.DomUtil.removeClass(d._container,"requesting"),a.DomUtil.removeClass(d._container,"active"),a.DomUtil.removeClass(d._container,"following"),n(),d._layer.clearLayers(),d._marker=void 0,d._circle=void 0},p=function(a){3==a.code&&d._locateOptions.watch||(o(),d.options.onLocationError(a))};return b.on("locationfound",g,d),b.on("locationerror",p,d),b.on("unload",o,d),this.locate=f,this.stopLocate=o,this.stopFollowing=i,c}}),a.Map.addInitHook(function(){this.options.locateControl&&(this.locateControl=a.control.locate(),this.addControl(this.locateControl))}),a.control.locate=function(b){return new a.Control.Locate(b)},function(){var b=function(b,c,d){d=d.split(" "),d.forEach(function(d){a.DomUtil[b].call(this,c,d)})};a.DomUtil.addClasses=function(a,c){b("addClass",a,c)},a.DomUtil.removeClasses=function(a,c){b("removeClass",a,c)}}(),a.Control.Locate},window);